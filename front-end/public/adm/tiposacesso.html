<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="headerADM.css">
  <link rel="stylesheet" href="acessos.css">
    <title>Tipos de acesso</title>
</head>
<body>


<body>
  <div class="header">
    <div class="container">
      <div class="logo">
        <a href="./empresas.html"><img class="imagem-logo" src="/assets/imagens/logoEmpresa.png" alt="logo empresa"></a>
      </div>
      <div class="navbar">
        <ul>
          <li><a href="./empresas.html">Empresas</a></li>
          <li><a href="usuarios.html">Usuários</a></li>
          <li><a href="./tiposacesso.html">Acessos</a></li>
        </ul>
      </div>
      <div id="user-profile" class="user-profile">
        <img class="img-user" src="./assets/userBranco.png" alt="">
        <div id="user-card" class="user-card">
          <div class="user-card-content">
            <p><span id="userName"></span> | ADM</p>
            <button id="logout-btn"><img class="icon-sair" src="./assets/exitBranco.png" alt="Icone de sair">Sair</button>
          </div>
        </div>
      </div>
    </div>
  </div>

      <div class="container-table"  id="containerTable">
        <div class="containerTittle"><h2>Lista Acessos</h2>
        <button onclick="adicionarNovoAcesso()">Cadastrar novo acesso</button></div>
        <table id="acessosTable">
            <thead>
                <tr>
                <th>ID Acesso</th>
                <th>Tipo de acesso</th>
                <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
        </table>
    </div>
</body>
</html>
<script>
function adicionarNovoAcesso(){
    window.location.href = "../adm/adicionarAcesso.html";
}
document.addEventListener('DOMContentLoaded', function() {
const userProfile = document.getElementById('user-profile');
const userCard = document.getElementById('user-card');
const logoutBtn = document.getElementById('logout-btn');
const acessosTableBody = document.querySelector('#acessosTable tbody');
const nomeUsuario = document.getElementById('userName');

nomeUsuario.innerHTML = sessionStorage.NOME_USUARIO;


userProfile.addEventListener('click', function() {
    userCard.classList.toggle('active');
});

document.addEventListener('click', function(event) {
    if (!userProfile.contains(event.target) && !userCard.contains(event.target)) {
        userCard.classList.remove('active');
    }
});

logoutBtn.addEventListener('click', function() {
    window.location.href = '../site/public/index.html';
});




fetch('/empresas/listarAcessos')
.then(response => response.json())
.then(data => {
  acessos = data
  console.log(acessos)
  preencherTabela(acessos)
})
.catch(error => console.error('Erro no fetch de acessos', error));




function preencherTabela(acessos) {
  acessosTableBody.innerHTML = '';
   acessos.forEach(acessos => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${acessos.id_tipo_acesso}</td>
            <td>${acessos.tipo}</td>
            <td>
                <button class="edit" onclick="editarAcesso(${acessos.id_tipo_acesso})">Editar</button>
                <button class="delete" onclick="deletarAcesso(${acessos.id_tipo_acesso})">Deletar</button>
            </td>
        `;
        acessosTableBody.appendChild(row);
    });
}


window.editarAcesso= function(id) {
  const acesso = acessos.find(acs => acs.id_tipo_acesso === id);
      if (acesso) {
        const nome = prompt('Editar nome do acesso:', acesso.tipo);
       
        if (nome) {
          fetch(`/empresas/editarAcesso/${id}`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nome: nome})
          })
            .then(response => response.json())
            .then(data => {
              if (data.mensagem) {
                alert(data.mensagem);
                atualizarTabela();
              } else {
                alert('Erro ao editar acesso');
              }
            })
            .catch(error => console.error('Error:', error));
        }
      }
    };



window.deletarAcesso = function(id) {
  const acesso = acessos.find(acs => acs.id_tipo_acesso === id);
  if (confirm('Tem certeza que deseja deletar este acesso?')) {
        fetch(`/empresas/deletarAcesso/${id}`, {
          method: 'DELETE'
        })
          .then(response => response.json())
          .then(data => {
            if (data.mensagem) {
              alert(data.mensagem);
              atualizarTabela();
            } else {
              alert('Erro ao deletar acesso');
            }
          })
          .catch(error => console.error('Error:', error));
      }
    };

    function atualizarTabela() {
      fetch('/empresas/listarAcessos')
        .then(response => response.json())
        .then(data => {
          acessos = data;
          preencherTabela(acessos);
        })
        .catch(error => console.error('Error fetch empresas:', error));
    }
  });
</script>
      